\hypertarget{client_l_e_f_t__arm_8cpp}{}\doxysection{src/client\+L\+E\+F\+T\+\_\+arm.cpp File Reference}
\label{client_l_e_f_t__arm_8cpp}\index{src/clientLEFT\_arm.cpp@{src/clientLEFT\_arm.cpp}}


T\+I\+A\+Go\textquotesingle{}s left arm controller.  


{\ttfamily \#include $<$exception$>$}\newline
{\ttfamily \#include $<$string$>$}\newline
{\ttfamily \#include $<$boost/shared\+\_\+ptr.\+hpp$>$}\newline
{\ttfamily \#include $<$ros/ros.\+h$>$}\newline
{\ttfamily \#include $<$actionlib/client/simple\+\_\+action\+\_\+client.\+h$>$}\newline
{\ttfamily \#include $<$control\+\_\+msgs/\+Follow\+Joint\+Trajectory\+Action.\+h$>$}\newline
{\ttfamily \#include $<$ros/topic.\+h$>$}\newline
{\ttfamily \#include $<$sensor\+\_\+msgs/\+Joint\+State.\+h$>$}\newline
{\ttfamily \#include $<$geometry\+\_\+msgs/\+Pose.\+h$>$}\newline
{\ttfamily \#include $<$my\+\_\+thesis\+\_\+pkg/\+My\+Inverse\+Kinematic.\+h$>$}\newline
{\ttfamily \#include $<$unity\+\_\+robotics\+\_\+demo\+\_\+msgs/\+My\+Pos\+Rot.\+h$>$}\newline
{\ttfamily \#include $<$unity\+\_\+robotics\+\_\+demo\+\_\+msgs/\+Pos\+Rot.\+h$>$}\newline
{\ttfamily \#include $<$tf/tf.\+h$>$}\newline
Include dependency graph for client\+L\+E\+F\+T\+\_\+arm.\+cpp\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{client_l_e_f_t__arm_8cpp__incl}
\end{center}
\end{figure}
\doxysubsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{client_l_e_f_t__arm_8cpp_a140410073d9a9eec80ce8bb30079ae1c}\label{client_l_e_f_t__arm_8cpp_a140410073d9a9eec80ce8bb30079ae1c}} 
typedef actionlib\+::\+Simple\+Action\+Client$<$ control\+\_\+msgs\+::\+Follow\+Joint\+Trajectory\+Action $>$ {\bfseries arm\+\_\+control\+\_\+client}
\item 
\mbox{\Hypertarget{client_l_e_f_t__arm_8cpp_a4a8f2006d7000e2b10f88acd36faf69d}\label{client_l_e_f_t__arm_8cpp_a4a8f2006d7000e2b10f88acd36faf69d}} 
typedef boost\+::shared\+\_\+ptr$<$ arm\+\_\+control\+\_\+client $>$ {\bfseries arm\+\_\+control\+\_\+client\+\_\+\+Ptr}
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{client_l_e_f_t__arm_8cpp_a1be66d5caf9d0a56ab8359c5b37e6e4c}{Unity\+Callback}} (const unity\+\_\+robotics\+\_\+demo\+\_\+msgs\+::\+Pos\+Rot\+Const\+Ptr \&msg)
\begin{DoxyCompactList}\small\item\em Subscriber Callback for /left\+\_\+arm\+\_\+frame\+\_\+topic. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{client_l_e_f_t__arm_8cpp_a9be178b6b9d7cfdf11626b3e2d69a5d7}{create\+Arm\+Client}} (arm\+\_\+control\+\_\+client\+\_\+\+Ptr \&action\+\_\+client, const std\+::string \&arm\+\_\+controller\+\_\+name)
\begin{DoxyCompactList}\small\item\em function to create action client \end{DoxyCompactList}\item 
void \mbox{\hyperlink{client_l_e_f_t__arm_8cpp_a3bbbb1b8386d2491a20c1f0672135984}{move\+Arm\+To\+Joint\+State}} (const control\+\_\+msgs\+::\+Follow\+Joint\+Trajectory\+Goal \&joint\+\_\+goal, arm\+\_\+control\+\_\+client\+\_\+\+Ptr \&action\+\_\+client)
\begin{DoxyCompactList}\small\item\em function to move T\+I\+A\+Go\textquotesingle{}s arm \end{DoxyCompactList}\item 
control\+\_\+msgs\+::\+Follow\+Joint\+Trajectory\+Goal \mbox{\hyperlink{client_l_e_f_t__arm_8cpp_a04573dccba63d13e77a4d53a63737dc2}{compute\+IK}} ()
\begin{DoxyCompactList}\small\item\em function to compute the Invesrse Kinematics on T\+I\+A\+Go\textquotesingle{}s geometry \end{DoxyCompactList}\item 
int \mbox{\hyperlink{client_l_e_f_t__arm_8cpp_a3c04138a5bfe5d72780bb7e82a18e627}{main}} (int argc, char $\ast$$\ast$argv)
\begin{DoxyCompactList}\small\item\em main function \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{client_l_e_f_t__arm_8cpp_a71a136031f2afb856f088aee2b46475c}\label{client_l_e_f_t__arm_8cpp_a71a136031f2afb856f088aee2b46475c}} 
ros\+::\+Service\+Client \mbox{\hyperlink{client_l_e_f_t__arm_8cpp_a71a136031f2afb856f088aee2b46475c}{ik\+Client}}
\begin{DoxyCompactList}\small\item\em global client definition \end{DoxyCompactList}\item 
\mbox{\Hypertarget{client_l_e_f_t__arm_8cpp_a047d41deea36aa029beacde5f9f2c60c}\label{client_l_e_f_t__arm_8cpp_a047d41deea36aa029beacde5f9f2c60c}} 
my\+\_\+thesis\+\_\+pkg\+::\+My\+Inverse\+Kinematic \mbox{\hyperlink{client_l_e_f_t__arm_8cpp_a047d41deea36aa029beacde5f9f2c60c}{goal\+\_\+frame}}
\begin{DoxyCompactList}\small\item\em global message definition \end{DoxyCompactList}\item 
\mbox{\Hypertarget{client_l_e_f_t__arm_8cpp_aa798006f094abc0bf35ea7d23a597f74}\label{client_l_e_f_t__arm_8cpp_aa798006f094abc0bf35ea7d23a597f74}} 
bool \mbox{\hyperlink{client_l_e_f_t__arm_8cpp_aa798006f094abc0bf35ea7d23a597f74}{new\+\_\+frame\+\_\+received}} = false
\begin{DoxyCompactList}\small\item\em global boolean to identify a different frame received \end{DoxyCompactList}\item 
\mbox{\Hypertarget{client_l_e_f_t__arm_8cpp_a6b5f06313b64607ddf8b576747d76ffb}\label{client_l_e_f_t__arm_8cpp_a6b5f06313b64607ddf8b576747d76ffb}} 
float \mbox{\hyperlink{client_l_e_f_t__arm_8cpp_a6b5f06313b64607ddf8b576747d76ffb}{prev\+\_\+roll}} = 0
\begin{DoxyCompactList}\small\item\em global variables to store hand\textquotesingle{}s previous roll value \end{DoxyCompactList}\item 
\mbox{\Hypertarget{client_l_e_f_t__arm_8cpp_a13e3058c8a59df76790035580269053c}\label{client_l_e_f_t__arm_8cpp_a13e3058c8a59df76790035580269053c}} 
float \mbox{\hyperlink{client_l_e_f_t__arm_8cpp_a13e3058c8a59df76790035580269053c}{prev\+\_\+pitch}} = 0
\begin{DoxyCompactList}\small\item\em global variables to store hand\textquotesingle{}s previous pitch value \end{DoxyCompactList}\item 
\mbox{\Hypertarget{client_l_e_f_t__arm_8cpp_ab41d9d021ca6fa059f8288f076b0d72c}\label{client_l_e_f_t__arm_8cpp_ab41d9d021ca6fa059f8288f076b0d72c}} 
float \mbox{\hyperlink{client_l_e_f_t__arm_8cpp_ab41d9d021ca6fa059f8288f076b0d72c}{prev\+\_\+yaw}} = 0
\begin{DoxyCompactList}\small\item\em global variables to store hand\textquotesingle{}s previous yaw value \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
T\+I\+A\+Go\textquotesingle{}s left arm controller. 

\begin{DoxyAuthor}{Author}
Claudio Del Gaizo 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
0.\+1 
\end{DoxyVersion}
\begin{DoxyDate}{Date}
7/12/2023
\end{DoxyDate}
Subscribes to\+: ~\newline


/left\+\_\+arm\+\_\+frame\+\_\+topic \+: to have info about user\textquotesingle{}s left hand\textquotesingle{}s movements from Unity

Action Client to\+: ~\newline


/arm\+\_\+left\+\_\+controller/follow\+\_\+joint\+\_\+trajectory \+: to move T\+I\+A\+Go\textquotesingle{}s left arm

Service client to\+: ~\newline


/my\+\_\+ik\+\_\+solver\+\_\+service \+: to send request about Inverse kinematics computations

Description\+:

This simple node subscribes to the /left\+\_\+arm\+\_\+frame\+\_\+topic to receive data from Unity\textquotesingle{}s publisher about the Pose of the user\textquotesingle{}s left hand. Then uses the received Pose to request an IK solution to /my\+\_\+ik\+\_\+solver\+\_\+service. In the end sends the configuration received as response to the /arm\+\_\+left\+\_\+controller/follow\+\_\+joint\+\_\+trajectory action servert to move T\+I\+A\+Go\textquotesingle{}s left arm. 

\doxysubsection{Function Documentation}
\mbox{\Hypertarget{client_l_e_f_t__arm_8cpp_a04573dccba63d13e77a4d53a63737dc2}\label{client_l_e_f_t__arm_8cpp_a04573dccba63d13e77a4d53a63737dc2}} 
\index{clientLEFT\_arm.cpp@{clientLEFT\_arm.cpp}!computeIK@{computeIK}}
\index{computeIK@{computeIK}!clientLEFT\_arm.cpp@{clientLEFT\_arm.cpp}}
\doxysubsubsection{\texorpdfstring{computeIK()}{computeIK()}}
{\footnotesize\ttfamily control\+\_\+msgs\+::\+Follow\+Joint\+Trajectory\+Goal compute\+IK (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



function to compute the Invesrse Kinematics on T\+I\+A\+Go\textquotesingle{}s geometry 

\begin{DoxyReturn}{Returns}
resulting\+\_\+joint\+\_\+goal\+: control\+\_\+msgs\+::\+Follow\+Joint\+Trajectory\+Goal\+: T\+I\+A\+GO\textquotesingle{}s arm joints\textquotesingle{} angles
\end{DoxyReturn}
function that takes desired frame\textquotesingle{}s positions contained in the global variable \textquotesingle{}goal\+\_\+frame\textquotesingle{} to call the \textquotesingle{}ik\+\_\+service\textquotesingle{} and returns as output the joint values contained in the service response \mbox{\Hypertarget{client_l_e_f_t__arm_8cpp_a9be178b6b9d7cfdf11626b3e2d69a5d7}\label{client_l_e_f_t__arm_8cpp_a9be178b6b9d7cfdf11626b3e2d69a5d7}} 
\index{clientLEFT\_arm.cpp@{clientLEFT\_arm.cpp}!createArmClient@{createArmClient}}
\index{createArmClient@{createArmClient}!clientLEFT\_arm.cpp@{clientLEFT\_arm.cpp}}
\doxysubsubsection{\texorpdfstring{createArmClient()}{createArmClient()}}
{\footnotesize\ttfamily void create\+Arm\+Client (\begin{DoxyParamCaption}\item[{arm\+\_\+control\+\_\+client\+\_\+\+Ptr \&}]{action\+\_\+client,  }\item[{const std\+::string \&}]{arm\+\_\+controller\+\_\+name }\end{DoxyParamCaption})}



function to create action client 


\begin{DoxyParams}{Parameters}
{\em action\+\_\+client} & \+: arm\+\_\+control\+\_\+client\+\_\+\+Ptr\& \+: the pointer to the action client\\
\hline
{\em arm\+\_\+controller\+\_\+name} & \+: std\+::string \+: the name of the controller\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void
\end{DoxyReturn}
This function is called to creat a client to the /arm\+\_\+left\+\_\+controller/follow\+\_\+joint\+\_\+trajectory action service, used to move T\+I\+A\+Go\textquotesingle{}s left arm \mbox{\Hypertarget{client_l_e_f_t__arm_8cpp_a3c04138a5bfe5d72780bb7e82a18e627}\label{client_l_e_f_t__arm_8cpp_a3c04138a5bfe5d72780bb7e82a18e627}} 
\index{clientLEFT\_arm.cpp@{clientLEFT\_arm.cpp}!main@{main}}
\index{main@{main}!clientLEFT\_arm.cpp@{clientLEFT\_arm.cpp}}
\doxysubsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily int main (\begin{DoxyParamCaption}\item[{int}]{argc,  }\item[{char $\ast$$\ast$}]{argv }\end{DoxyParamCaption})}



main function 

Entry point. Initializes the node, the subscriber to /left\+\_\+arm\+\_\+frame\+\_\+topic, the action client to move T\+I\+A\+GO\textquotesingle{}s arm and the service client to /my\+\_\+ik\+\_\+solver\+\_\+service. Then in the main loop, waits for a new position to be received, then calls the \textquotesingle{}\mbox{\hyperlink{client_l_e_f_t__arm_8cpp_a04573dccba63d13e77a4d53a63737dc2}{compute\+I\+K()}}\textquotesingle{} function to send a request to /my\+\_\+ik\+\_\+solver\+\_\+service, in order to compute the inverse Kinematics of the Hand pose received. In the end, if IK was computed succesfully, moves the robot sending the joints configuration obtained to the action service /arm\+\_\+left\+\_\+controller/follow\+\_\+joint\+\_\+trajectory. \mbox{\Hypertarget{client_l_e_f_t__arm_8cpp_a3bbbb1b8386d2491a20c1f0672135984}\label{client_l_e_f_t__arm_8cpp_a3bbbb1b8386d2491a20c1f0672135984}} 
\index{clientLEFT\_arm.cpp@{clientLEFT\_arm.cpp}!moveArmToJointState@{moveArmToJointState}}
\index{moveArmToJointState@{moveArmToJointState}!clientLEFT\_arm.cpp@{clientLEFT\_arm.cpp}}
\doxysubsubsection{\texorpdfstring{moveArmToJointState()}{moveArmToJointState()}}
{\footnotesize\ttfamily void move\+Arm\+To\+Joint\+State (\begin{DoxyParamCaption}\item[{const control\+\_\+msgs\+::\+Follow\+Joint\+Trajectory\+Goal \&}]{joint\+\_\+goal,  }\item[{arm\+\_\+control\+\_\+client\+\_\+\+Ptr \&}]{action\+\_\+client }\end{DoxyParamCaption})}



function to move T\+I\+A\+Go\textquotesingle{}s arm 


\begin{DoxyParams}{Parameters}
{\em joint\+\_\+goal} & \+: control\+\_\+msgs\+::\+Follow\+Joint\+Trajectory\+Goal\+: the values of joints angles to control T\+I\+A\+Go\textquotesingle{}s arm\\
\hline
{\em action\+\_\+client} & \+: arm\+\_\+control\+\_\+client\+\_\+\+Ptr\& \+: the pointer to the action client\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void
\end{DoxyReturn}
This function is called to eventually move T\+I\+A\+Go\textquotesingle{}s arm by sending the joint configuration to the action server /arm\+\_\+left\+\_\+controller/follow\+\_\+joint\+\_\+trajectory \mbox{\Hypertarget{client_l_e_f_t__arm_8cpp_a1be66d5caf9d0a56ab8359c5b37e6e4c}\label{client_l_e_f_t__arm_8cpp_a1be66d5caf9d0a56ab8359c5b37e6e4c}} 
\index{clientLEFT\_arm.cpp@{clientLEFT\_arm.cpp}!UnityCallback@{UnityCallback}}
\index{UnityCallback@{UnityCallback}!clientLEFT\_arm.cpp@{clientLEFT\_arm.cpp}}
\doxysubsubsection{\texorpdfstring{UnityCallback()}{UnityCallback()}}
{\footnotesize\ttfamily void Unity\+Callback (\begin{DoxyParamCaption}\item[{const unity\+\_\+robotics\+\_\+demo\+\_\+msgs\+::\+Pos\+Rot\+Const\+Ptr \&}]{msg }\end{DoxyParamCaption})}



Subscriber Callback for /left\+\_\+arm\+\_\+frame\+\_\+topic. 


\begin{DoxyParams}{Parameters}
{\em msg} & \+: unity\+\_\+robotics\+\_\+demo\+\_\+msgs\+::\+My\+Pos\+Rot\+Const\+Ptr\& \+: a 7D Pose of user\textquotesingle{}s left palm\textquotesingle{}s frame. orientation expressed in Quaternions.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void
\end{DoxyReturn}
Callback function to receive data from Unity\textquotesingle{}s publisher about the Pose of the user\textquotesingle{}s left hand. Converts orientation from quaternions into Euler angles and updates the value of \textquotesingle{}goal\+\_\+frame\textquotesingle{} global variable. 