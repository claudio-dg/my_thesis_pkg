<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ROS components Documentation: src/move_head_joint.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ROS components Documentation
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
   <div id="projectbrief">ROS package for my master thesis in robotics engineering, containing the controllers to move TIAGo robot.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">move_head_joint.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>TIAGo's head controller.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;exception&gt;</code><br />
<code>#include &lt;string&gt;</code><br />
<code>#include &lt;boost/shared_ptr.hpp&gt;</code><br />
<code>#include &lt;geometry_msgs/Pose.h&gt;</code><br />
<code>#include &lt;ros/ros.h&gt;</code><br />
<code>#include &lt;actionlib/client/simple_action_client.h&gt;</code><br />
<code>#include &lt;control_msgs/FollowJointTrajectoryAction.h&gt;</code><br />
<code>#include &lt;ros/topic.h&gt;</code><br />
<code>#include &lt;unity_robotics_demo_msgs/MyPosRot.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for move_head_joint.cpp:</div>
<div class="dyncontent">
<div class="center"><img src="move__head__joint_8cpp__incl.png" border="0" usemap="#src_2move__head__joint_8cpp" alt=""/></div>
<map name="src_2move__head__joint_8cpp" id="src_2move__head__joint_8cpp">
<area shape="rect" title="TIAGo&#39;s head controller." alt="" coords="529,5,713,32"/>
<area shape="rect" title=" " alt="" coords="5,87,92,114"/>
<area shape="rect" title=" " alt="" coords="117,87,175,114"/>
<area shape="rect" title=" " alt="" coords="200,87,359,114"/>
<area shape="rect" title=" " alt="" coords="383,87,557,114"/>
<area shape="rect" title=" " alt="" coords="581,87,660,114"/>
<area shape="rect" title=" " alt="" coords="684,80,851,121"/>
<area shape="rect" title=" " alt="" coords="875,80,1059,121"/>
<area shape="rect" title=" " alt="" coords="1083,87,1174,114"/>
<area shape="rect" title=" " alt="" coords="1199,80,1357,121"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ae68c8b899e24843ae1611f446f97ca62"><td class="memItemLeft" align="right" valign="top"><a id="ae68c8b899e24843ae1611f446f97ca62"></a>
typedef actionlib::SimpleActionClient&lt; control_msgs::FollowJointTrajectoryAction &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>head_control_client</b></td></tr>
<tr class="separator:ae68c8b899e24843ae1611f446f97ca62"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a021b709b37231b432c187b2bfe4d9054"><td class="memItemLeft" align="right" valign="top"><a id="a021b709b37231b432c187b2bfe4d9054"></a>
typedef boost::shared_ptr&lt; head_control_client &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>head_control_client_Ptr</b></td></tr>
<tr class="separator:a021b709b37231b432c187b2bfe4d9054"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aa246d58b1957b6ce2f4b2f37c9b56fb7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="move__head__joint_8cpp.html#aa246d58b1957b6ce2f4b2f37c9b56fb7">createHeadClient</a> (head_control_client_Ptr &amp;action_client, const std::string head_controller_name)</td></tr>
<tr class="memdesc:aa246d58b1957b6ce2f4b2f37c9b56fb7"><td class="mdescLeft">&#160;</td><td class="mdescRight">function to create action client  <a href="move__head__joint_8cpp.html#aa246d58b1957b6ce2f4b2f37c9b56fb7">More...</a><br /></td></tr>
<tr class="separator:aa246d58b1957b6ce2f4b2f37c9b56fb7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a71d7bab3cef95744a862bc164d37069b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="move__head__joint_8cpp.html#a71d7bab3cef95744a862bc164d37069b">UnityCallback</a> (const unity_robotics_demo_msgs::MyPosRotConstPtr &amp;msg)</td></tr>
<tr class="memdesc:a71d7bab3cef95744a862bc164d37069b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback for the /head_frame_topic.  <a href="move__head__joint_8cpp.html#a71d7bab3cef95744a862bc164d37069b">More...</a><br /></td></tr>
<tr class="separator:a71d7bab3cef95744a862bc164d37069b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="move__head__joint_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (int argc, char **argv)</td></tr>
<tr class="memdesc:a3c04138a5bfe5d72780bb7e82a18e627"><td class="mdescLeft">&#160;</td><td class="mdescRight">main function  <a href="move__head__joint_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">More...</a><br /></td></tr>
<tr class="separator:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a26fd84d522945b6038221d9e38c7cc39"><td class="memItemLeft" align="right" valign="top"><a id="a26fd84d522945b6038221d9e38c7cc39"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><b>roll</b></td></tr>
<tr class="separator:a26fd84d522945b6038221d9e38c7cc39"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a282e7d4378d4a18a805b8980295ac86c"><td class="memItemLeft" align="right" valign="top"><a id="a282e7d4378d4a18a805b8980295ac86c"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><b>pitch</b></td></tr>
<tr class="separator:a282e7d4378d4a18a805b8980295ac86c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7efc219781df4a1e281cb5d348b7fbf9"><td class="memItemLeft" align="right" valign="top"><a id="a7efc219781df4a1e281cb5d348b7fbf9"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="move__head__joint_8cpp.html#a7efc219781df4a1e281cb5d348b7fbf9">yaw</a></td></tr>
<tr class="memdesc:a7efc219781df4a1e281cb5d348b7fbf9"><td class="mdescLeft">&#160;</td><td class="mdescRight">global variables to store head's orientation <br /></td></tr>
<tr class="separator:a7efc219781df4a1e281cb5d348b7fbf9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a18b70c13e39099a8cb0b7a3e3f612193"><td class="memItemLeft" align="right" valign="top"><a id="a18b70c13e39099a8cb0b7a3e3f612193"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="move__head__joint_8cpp.html#a18b70c13e39099a8cb0b7a3e3f612193">old_pitch</a> = 0</td></tr>
<tr class="memdesc:a18b70c13e39099a8cb0b7a3e3f612193"><td class="mdescLeft">&#160;</td><td class="mdescRight">global variables to store head's previous pitch value <br /></td></tr>
<tr class="separator:a18b70c13e39099a8cb0b7a3e3f612193"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa7be88356c42f6807dbe0b2a9b9a8297"><td class="memItemLeft" align="right" valign="top"><a id="aa7be88356c42f6807dbe0b2a9b9a8297"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="move__head__joint_8cpp.html#aa7be88356c42f6807dbe0b2a9b9a8297">old_yaw</a> = 0</td></tr>
<tr class="memdesc:aa7be88356c42f6807dbe0b2a9b9a8297"><td class="mdescLeft">&#160;</td><td class="mdescRight">global variables to store head's previous yaw value <br /></td></tr>
<tr class="separator:aa7be88356c42f6807dbe0b2a9b9a8297"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa4242f133d4451c50dcc781d2b6081fb"><td class="memItemLeft" align="right" valign="top"><a id="aa4242f133d4451c50dcc781d2b6081fb"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="move__head__joint_8cpp.html#aa4242f133d4451c50dcc781d2b6081fb">different_rotation</a> = false</td></tr>
<tr class="memdesc:aa4242f133d4451c50dcc781d2b6081fb"><td class="mdescLeft">&#160;</td><td class="mdescRight">global boolean to identify a different rotation <br /></td></tr>
<tr class="separator:aa4242f133d4451c50dcc781d2b6081fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa2bc74879866162116c6f9b1849baa5"><td class="memItemLeft" align="right" valign="top"><a id="afa2bc74879866162116c6f9b1849baa5"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="move__head__joint_8cpp.html#afa2bc74879866162116c6f9b1849baa5">different_inclination</a> = false</td></tr>
<tr class="memdesc:afa2bc74879866162116c6f9b1849baa5"><td class="mdescLeft">&#160;</td><td class="mdescRight">global boolean to identify a different orientation <br /></td></tr>
<tr class="separator:afa2bc74879866162116c6f9b1849baa5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa798006f094abc0bf35ea7d23a597f74"><td class="memItemLeft" align="right" valign="top"><a id="aa798006f094abc0bf35ea7d23a597f74"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="move__head__joint_8cpp.html#aa798006f094abc0bf35ea7d23a597f74">new_frame_received</a> = false</td></tr>
<tr class="memdesc:aa798006f094abc0bf35ea7d23a597f74"><td class="mdescLeft">&#160;</td><td class="mdescRight">global boolean to identify a different frame received <br /></td></tr>
<tr class="separator:aa798006f094abc0bf35ea7d23a597f74"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a29a2ba9926a1f2c6b5459b20829521e3"><td class="memItemLeft" align="right" valign="top"><a id="a29a2ba9926a1f2c6b5459b20829521e3"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="move__head__joint_8cpp.html#a29a2ba9926a1f2c6b5459b20829521e3">joint_min_limits</a> [2] = {-1.24, -0.98}</td></tr>
<tr class="memdesc:a29a2ba9926a1f2c6b5459b20829521e3"><td class="mdescLeft">&#160;</td><td class="mdescRight">robot's head joint minimum limits <br /></td></tr>
<tr class="separator:a29a2ba9926a1f2c6b5459b20829521e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a49baa3c6927be1791c51689dcc1a0cb9"><td class="memItemLeft" align="right" valign="top"><a id="a49baa3c6927be1791c51689dcc1a0cb9"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="move__head__joint_8cpp.html#a49baa3c6927be1791c51689dcc1a0cb9">joint_max_limits</a> [2] = {1.24, 0.72}</td></tr>
<tr class="memdesc:a49baa3c6927be1791c51689dcc1a0cb9"><td class="mdescLeft">&#160;</td><td class="mdescRight">robot's head joint maximum limits <br /></td></tr>
<tr class="separator:a49baa3c6927be1791c51689dcc1a0cb9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>TIAGo's head controller. </p>
<dl class="section author"><dt>Author</dt><dd>Claudio Del Gaizo </dd></dl>
<dl class="section version"><dt>Version</dt><dd>0.1 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>7/12/2023</dd></dl>
<p>Subscribes to: <br  />
</p>
<p>/head_frame_topic : to have info about user's head orientation from Unity</p>
<p>Action Client to: <br  />
</p>
<p>/head_controller/follow_joint_trajectory : to move TIAGo's head</p>
<p>Description:</p>
<p>This simple node subscribes to the /head_frame_topic to receive data from Unity's publisher about the orientation of the user's head. Then maps the received Pitch and Yaw values with the joints of the robot head, to let TIAGo' head perform the same rotations of user's head. To do so it involves the /head_controller/follow_joint_trajectory action service. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="aa246d58b1957b6ce2f4b2f37c9b56fb7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa246d58b1957b6ce2f4b2f37c9b56fb7">&#9670;&nbsp;</a></span>createHeadClient()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void createHeadClient </td>
          <td>(</td>
          <td class="paramtype">head_control_client_Ptr &amp;&#160;</td>
          <td class="paramname"><em>action_client</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>head_controller_name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>function to create action client </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">action_client</td><td>: head_control_client_Ptr&amp; : the pointer to the action client</td></tr>
    <tr><td class="paramname">head_controller_name</td><td>: std::string : the name of the controller</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void</dd></dl>
<p>This function is called to creat a client to the /head_controller/follow_joint_trajectory action service, used to move TIAGo's head </p>

</div>
</div>
<a id="a3c04138a5bfe5d72780bb7e82a18e627"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c04138a5bfe5d72780bb7e82a18e627">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>argv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>main function </p>
<p>Entry point. Initializes the node, the subscriber to /head_frame_topic and the action client to move TIAGO's head. Then in the main loop, send a new goal to the action service each time a different user's head orientation is correctly received. Directly maps pitch and yaw values discarding roll's as TIAGo's head has 2 DoF. </p>

</div>
</div>
<a id="a71d7bab3cef95744a862bc164d37069b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a71d7bab3cef95744a862bc164d37069b">&#9670;&nbsp;</a></span>UnityCallback()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UnityCallback </td>
          <td>(</td>
          <td class="paramtype">const unity_robotics_demo_msgs::MyPosRotConstPtr &amp;&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback for the /head_frame_topic. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>: unity_robotics_demo_msgs::MyPosRotConstPtr&amp; : a 6D Pose of user's head frame. orientation expressed in RPY</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void</dd></dl>
<p>Callback function to receive msgs from UNITY environment about VR Head Mounted Display rotation. Receive RPY data from UNITY, performs limits'check and compares current orientation with previous one to notify the main function when a different rotation has been received. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
